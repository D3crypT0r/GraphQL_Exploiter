import os
import shutil
import http.server
import socketserver
import sys

def run_exploit():
    os.chdir("/app")
    os.system("python /app/exploit.py " + " ".join(sys.argv[1:]))

def create_zip():
    shutil.make_archive("/tmp/all", 'zip', "/app", "reqcache", "reqcache-intro", "reqcache-queries")
    shutil.move("/tmp/all.zip", "/app/all.zip")

def serve_zip():
    os.chdir("/app")
    with socketserver.TCPServer(("", 80), http.server.SimpleHTTPRequestHandler) as httpd:
        print("Webserver listening, port 80")
        httpd.serve_forever()

if __name__ == "__main__":
    run_exploit()
    create_zip()
    serve_zip()
